# Sprint S04 — Supporting Pages

> **狀態**: `pending`
> **預估時間**: 3 小時
> **前置 Sprint**: S02（Data Layer）

---

## Stage 0: Sprint Kickoff

### 前次 Sprint 回顧

- 前次 Sprint: S02（Data Layer）
- [ ] 確認 `services/*.py` 可呼叫（CRUD 函式正常）
- [ ] 確認 `services/annual_plan.py`、`services/crm.py`、`services/sales_plan.py` 的 CRUD 可用

### Sprint 目標宣告

> 完成輔助頁面，年度戰略/CRM/商機可管理

### 前置條件檢查

- [ ] S02 已完成（狀態為 `completed`）
- [ ] 已閱讀 `docs/DEVELOPMENT_PLAN.md` Section 4（頁面 2-5 設計）
- [ ] 如 S03 已完成，確認 `components/sidebar.py` 可用

### Session 意圖

- 精神狀態：（Sprint 開始時填寫）
- 時間預算：（Sprint 開始時填寫）
- 特別注意事項：（Sprint 開始時填寫）

---

## Stage 1: Sprint Planning

### User Stories

- [ ] **US-1**: 作為業務主管，我希望在年度戰略頁面看到所有產品的列表（含產品名、年度目標、策略、鎖定產業），以便總覽年度戰略佈局
- [ ] **US-2**: 作為業務主管，我希望在年度戰略頁面新增/編輯產品資料（st.form），以便維護年度戰略
- [ ] **US-3**: 作為業務人員，我希望在客戶管理頁面看到所有客戶的列表（含公司名、產業、聯絡人、決策者），以便快速查閱客戶資訊
- [ ] **US-4**: 作為業務人員，我希望在客戶管理頁面新增/編輯客戶資料，特別是決策者（decision_maker）與內部擁護者（champion）的 JSON 欄位能以獨立的 text_input 呈現，以便直覺地維護利害關係人資訊
- [ ] **US-5**: 作為業務人員，我希望在商機預測頁面看到所有商機列表（含關聯專案、產品、預計開票日、金額、信心指數），以便追蹤業績預測
- [ ] **US-6**: 作為業務人員，我希望在商機預測頁面新增/編輯商機（st.form），專案與產品欄位為下拉選單（從 DB 讀取），信心指數為 slider (0~1)，以便快速維護商機資料

### Definition of Done（完成定義）

- [ ] `pages/annual_plan.py` 上方顯示年度戰略列表 st.dataframe
- [ ] 年度戰略新增/編輯表單包含：product_id, product_name, quota_fy26, strategy, target_industry
- [ ] `pages/crm.py` 上方顯示客戶列表 st.dataframe
- [ ] 客戶新增/編輯表單中，decision_maker 與 champion 的 JSON 欄位分別拆為 name/title/style 與 name/title/notes 的獨立 text_input
- [ ] `pages/sales_plan.py` 上方顯示商機列表 st.dataframe
- [ ] 商機新增/編輯表單中，project_id 與 product_id 為下拉選單，confidence_level 為 st.slider(0.0, 1.0, 0.5, 0.05)
- [ ] 三個頁面在 `streamlit run` 後可正常顯示（無 Python error）
- [ ] 新增資料後重整頁面，列表顯示新資料

### Context Files（AI 參考檔案）

開始此 Sprint 前，將以下檔案提供給 AI：
- `docs/DEVELOPMENT_PLAN.md` — Section 4（頁面 2-5 設計）
- `services/annual_plan.py` — 年度戰略 CRUD API
- `services/crm.py` — 客戶 CRUD API
- `services/sales_plan.py` — 商機預測 CRUD API
- `services/project.py` — 專案 CRUD（用於下拉選單）
- `models/schemas.py` — Pydantic 模型
- `components/sidebar.py` — 側邊欄元件（如已完成 S03）

---

## Stage 2: Vibe Coding

### 實作紀錄

> 在開發過程中記錄重要決策與遇到的問題。

- （Sprint 開始後填寫）

### TODO / 技術債

- [ ] （Sprint 開始後填寫）

---

## Stage 3: Sprint Review

### DoD 驗證結果

| # | 條件 | 通過? | 備註 |
|---|------|-------|------|
| 1 | annual_plan.py dataframe 顯示 | | |
| 2 | 年度戰略表單欄位完整 | | |
| 3 | crm.py dataframe 顯示 | | |
| 4 | CRM JSONB 欄位拆為獨立 input | | |
| 5 | sales_plan.py dataframe 顯示 | | |
| 6 | 商機表單下拉選單與 slider 正確 | | |
| 7 | 三頁面 streamlit run 無錯誤 | | |
| 8 | 新增資料後列表更新 | | |

### 發現的問題

- （Review 後填寫）

---

## Stage 4: Retrospective & Refactor

### 修復項目

- [ ] （Retro 後填寫）

### Retro: What went well

- （Retro 後填寫）

### Retro: What didn't go well

- （Retro 後填寫）

### Retro: Action items for next sprint

- [ ] （Retro 後填寫）

### Retro: AI 協作筆記

- 有效的 prompt/context：（Retro 後填寫）
- 無效的 prompt/context：（Retro 後填寫）

### Retro: 時間追蹤

- 預估時間：3 小時
- 實際時間：（Sprint 結束後填寫）
- 差異原因：（Sprint 結束後填寫）

### Git Commit

- commit hash: `[填入]`
- message: `[填入]`
