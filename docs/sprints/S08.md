# Sprint S08 — Navigation Restructuring

> **Phase**: 2 (導航重構)
> **狀態**: 完成

## 目標

S07 完成後使用者 retro 回饋：8 個頁面扁平排列缺乏層級概念。依業務邏輯分組為大分頁（sections），並新增「已結案客戶」頁面。

## 完成項目

### Task 1: Data Layer — get_closed()
- `services/project.py` — 新增 `get_closed()` 方法
- JOIN crm 表取得客戶資訊（company_name, department, decision_maker, champion, industry）
- 查詢 P2/LOST/HOLD 狀態專案

### Task 2: 新頁面 pages/post_closure.py
- P2/LOST/HOLD 數量 metrics
- 狀態篩選（multiselect）
- 依客戶分組顯示（expander），含客戶資訊與專案列表

### Task 3: Sidebar 分組導航
- `components/sidebar.py` — `_PAGE_LINKS` → `_NAV_SECTIONS` 分組結構
- 6 個 sections：工作日誌(standalone) / 年度戰略 / 售前管理(4 sub) / 售後管理 / 客戶關係管理 / 設定(standalone)
- 多頁 section 子頁面以全形空格縮排
- sections 之間以 divider 分隔

### Task 4: app.py + settings + header defaults
- `app.py` — 新增 post_closure 頁面，重排順序
- Header defaults 更新：presale→案件管理, postsale→專案管理, annual_plan→產品策略管理
- `pages/settings.py` — HEADER_KEYS 增至 8 個
- `pages/presale.py`, `pages/postsale.py`, `pages/annual_plan.py` — 更新 fallback

### Task 5: Seed Data + Migration
- `database/seed.py` — 新增 LOST/HOLD demo projects（富邦金控舊系統汰換案、華碩 AI 語音辨識案）
- `database/schema.sql` — 更新 app_settings INSERT defaults
- `database/migrate_s08.py` — 遷移腳本（INSERT header_post_closure + 條件式 UPDATE defaults）

### Task 6: 文件更新
- `CLAUDE.md` — 新增分組導航描述，更新 sprint 範圍
- `docs/DEVELOPMENT_PLAN.md` — 更新導航結構、頁面清單（9 頁）、目錄結構、sprint 表
- `docs/sprints/S08.md` — 本文件

## 變更檔案

| 檔案 | 動作 |
|------|------|
| `services/project.py` | MODIFY — 新增 get_closed() |
| `database/schema.sql` | MODIFY — 更新 app_settings seed |
| `database/seed.py` | MODIFY — 新增 LOST/HOLD demo projects |
| `database/migrate_s08.py` | CREATE — 遷移腳本 |
| `pages/post_closure.py` | CREATE — 已結案客戶頁面 |
| `components/sidebar.py` | MODIFY — 分組導航 |
| `app.py` | MODIFY — 新增頁面、更新順序 |
| `pages/presale.py` | MODIFY — fallback "案件管理" |
| `pages/postsale.py` | MODIFY — fallback "專案管理" |
| `pages/annual_plan.py` | MODIFY — fallback "產品策略管理" |
| `pages/settings.py` | MODIFY — HEADER_KEYS 增至 8 個 |
| `CLAUDE.md` | MODIFY — 導航架構描述 |
| `docs/DEVELOPMENT_PLAN.md` | MODIFY — 頁面清單、目錄結構 |
| `docs/sprints/S08.md` | CREATE — 本文件 |
