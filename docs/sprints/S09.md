# Sprint S09 — Work Log Split + Postsale Project Detail

> **Phase**: 2 (功能深化)
> **狀態**: 完成

## 目標

S08 完成後使用者 retro 回饋兩點：
1. 工作日誌想分成兩塊：填寫內容 + 日誌紀錄查看
2. 售後管理希望點進每個案子後，看到專案的工作分項（sub-tasks）、甘特圖、燃盡圖

新建 `project_task` 表，拆分工作日誌頁面，新增售後專案詳情頁。

## 完成項目

### Task 1: Database — project_task 表
- `constants.py` — 新增 `TASK_STATUSES`（planned/in_progress/completed）
- `database/schema.sql` — 新增 `project_task` DDL
- `database/migrate_s09.py` — 建表遷移腳本（冪等）

### Task 2: Service Layer — services/project_task.py
- CRUD: create, get_by_project, get_by_id, update, delete
- 聚合: get_summary（total/completed tasks + hours）
- 燃盡圖: get_completed_by_date（累計已完成工時）

### Task 3: Seed Data
- `database/seed.py` — 為 project 6（台積電資料平台建置）新增 7 筆 demo tasks
- 2 completed + 2 in_progress + 3 planned，共 160 est / 70 actual hours

### Task 4: Work Log 拆分
- `pages/work_log.py` — 改為兩個 tabs
  - Tab 1「填寫工作日誌」：現有邏輯（活躍專案選擇器 + 表單 + 最近 5 筆）
  - Tab 2「日誌紀錄」：所有專案選擇器 + 完整 logs + summary

### Task 5: 售後專案詳情頁
- `pages/postsale_detail.py` — 獨立頁面
  - Header: 專案名稱 + 狀態/客戶/產品/負責人/優先級 metrics
  - 工作分解: 任務列表 + 新增任務（兩個 tabs）
  - 甘特圖: plotly.express.timeline，依 status 上色
  - 燃盡圖: plotly.graph_objects，理想線（虛線）+ 實際線（實線）
  - 返回按鈕

### Task 6: postsale.py 連結
- 每個專案加「查看詳情」按鈕 → st.switch_page + query_params

### Task 7: app.py 註冊
- 新增 postsale_detail 頁面至 st.navigation（不加入 sidebar）

### Task 8: 文件更新
- `CLAUDE.md` — 新增 project_task 表描述、更新 sprint 範圍
- `docs/sprints/S09.md` — 本文件

## 變更檔案

| 檔案 | 動作 |
|------|------|
| `constants.py` | MODIFY — 新增 TASK_STATUSES |
| `database/schema.sql` | MODIFY — 新增 project_task DDL |
| `database/migrate_s09.py` | CREATE — 建表遷移腳本 |
| `database/seed.py` | MODIFY — 新增 7 筆 demo tasks |
| `services/project_task.py` | CREATE — 子任務 CRUD + 聚合 |
| `pages/work_log.py` | MODIFY — 拆成兩個 tabs |
| `pages/postsale_detail.py` | CREATE — 專案詳情頁 |
| `pages/postsale.py` | MODIFY — 加「查看詳情」按鈕 |
| `app.py` | MODIFY — 註冊 postsale_detail 頁面 |
| `CLAUDE.md` | MODIFY — 更新架構描述 |
| `docs/sprints/S09.md` | CREATE — 本文件 |
