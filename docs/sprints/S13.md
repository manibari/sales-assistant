# Sprint S13 — 全域搜尋 + Visual Board

> **狀態**: `completed`
> **預估時間**: 3 小時
> **前置 Sprint**: S12

---

## Stage 0: Sprint Kickoff

### 前次 Sprint 回顧

- 前次 Sprint: S12 — 活動時間軸 + 售前任務 + 下一步行動
- 完成狀態: ✅ 已完成（due_date、is_next_action、今日待辦提醒、逾期待辦清單、近期活動摘要）

### Sprint 目標宣告

> 建立全域搜尋功能與售前看板，提供跨資料表的快速查詢入口和視覺化的售前階段管理。

### 前置條件檢查

- [x] S12 已完成
- [x] 所有資料表結構穩定
- [x] 環境就緒

### Session 意圖

- 精神狀態：專注
- 時間預算：3 小時
- 特別注意事項：搜尋需橫跨 contact、crm、project_list 三張表；看板需支援拖拉式狀態推進

---

## Stage 1: Sprint Planning

### User Stories

- [x] **US-1**: 作為業務人員，我希望有全域搜尋功能，以便快速找到聯絡人、客戶或專案
- [x] **US-2**: 作為業務人員，我希望有售前看板（Kanban Board），以便直觀地查看各階段的案件分佈
- [x] **US-3**: 作為業務人員，我希望從搜尋結果能直接跳轉到對應的詳情頁，以便快速操作

### Definition of Done（完成定義）

- [x] DoD-1: `services/search.py` 提供 search_all() 跨表 ILIKE 搜尋
- [x] DoD-2: `pages/search.py` 全域搜尋頁面可正常運作
- [x] DoD-3: 搜尋結果可跳轉至 presale_detail / postsale_detail
- [x] DoD-4: `pages/kanban.py` 售前看板顯示 L0-L6 階段欄位
- [x] DoD-5: 看板支援停滯警示（>14 天標紅）和快速推進按鈕
- [x] DoD-6: `components/sidebar.py` 導航已加入全域搜尋 + 售前看板

### Context Files（AI 參考檔案）

- `services/contact.py` — 聯絡人 CRUD
- `services/project.py` — 專案 CRUD
- `pages/presale_detail.py` — 售前詳情頁
- `components/sidebar.py` — 導航結構
- `app.py` — 頁面註冊

---

## Stage 2: Vibe Coding

### 實作紀錄

- 新建 `services/search.py`：search_all() 跨 contact / crm / project_list 的 ILIKE 搜尋
- 新建 `pages/search.py`：全域搜尋頁面，結果分類顯示（聯絡人/客戶/專案），專案結果可跳轉詳情頁
- 新建 `pages/kanban.py`：售前看板（L0-L6 欄位式佈局），含停滯警示 + 快速推進按鈕
- 修改 `components/sidebar.py`：導航加入「售前看板」（售前管理區塊）+ 「全域搜尋」（standalone）
- 修改 `app.py`：註冊 kanban.py + search.py 頁面

### TODO / 技術債

- [ ] 未來可加入搜尋歷史或常用搜尋
- [ ] 看板可考慮加入拖拉排序功能（目前用按鈕推進）

---

## Stage 3: Sprint Review

### DoD 驗證結果

| # | 條件 | 通過? | 備註 |
|---|------|-------|------|
| 1 | search_all() 跨表搜尋 | ✅ | ILIKE 搜尋 contact + crm + project_list，limit 50 |
| 2 | 全域搜尋頁面 | ✅ | 分類顯示結果 |
| 3 | 搜尋跳轉詳情頁 | ✅ | L* → presale_detail, P* → postsale_detail |
| 4 | 售前看板 L0-L6 | ✅ | 欄位式佈局，可篩選階段 |
| 5 | 停滯警示 + 推進 | ✅ | >14 天標紅，→ L* 按鈕 |
| 6 | 導航已更新 | ✅ | sidebar + app.py |

### 發現的問題

- 無重大問題

---

## Stage 4: Retrospective & Refactor

### 修復項目

- 無需修復

### Retro: What went well

- search_all() 設計簡潔，一個 function 搜三張表
- 搜尋結果的 smart routing（依 status_code 前綴決定跳轉目標）實用
- 看板以 st.columns 實現，無需額外 JS 套件

### Retro: What didn't go well

- 與 S11/S12 同時開發，沒有獨立的 Sprint 流程
- app.py 的 S13 頁面註冊與 S11 變更混在同一檔案
- DEVELOPMENT_PLAN.md 的 S13 描述（匯出與批次操作）與實際實作（全域搜尋 + 看板）完全不同

### Retro: Action items for next sprint

- [x] 補建 Sprint 文件
- [x] 更新 DEVELOPMENT_PLAN.md 與 CLAUDE.md
- [ ] 下一個 Sprint 恢復正常五階段流程
- [ ] 匯出與批次操作功能移至未來 Sprint 規劃

### Retro: AI 協作筆記

- 有效的 prompt/context：提供現有 sidebar 結構 + app.py 頁面註冊 pattern
- 無效的 prompt/context：無
- 教訓：Sprint 描述與實際實作偏離時，應即時更新文件

### Retro: 時間追蹤

- 預估時間：3 小時
- 實際時間：~1.5 小時（與 S11/S12 共同開發，無法精確拆分）
- 差異原因：三個 Sprint 一次性完成

### Git Commit

- commit hash: `（補救 commit）`
- message: `feat(S13): global search + visual board`
