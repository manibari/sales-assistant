# Sprint S18 — AI 智慧記錄 (Phase 1)

> **狀態**: `in_progress`
> **預估時間**: 3 小時
> **前置 Sprint**: S17

---

## Stage 0: Sprint Kickoff

### 前次 Sprint 回顧

- 前次 Sprint: S17
- 完成狀態: 已完成。`work_log` 頁面的 Bug 已修復，並新增了「快速記錄」功能。

### Sprint 目標宣告

> 建立「AI 智慧記錄」功能的第一版，讓使用者能透過自然語言輸入，自動解析出客戶名稱和活動內容，並建立或關聯對應的「客戶資料 (CRM)」和「工作日誌 (Work Log)」。

### 前置條件檢查

- [x] S17 已完成。
- [x] 開發計畫已對齊：確認採用 Gemini API 作為 NLP 模型，並分階段交付。

### Session 意圖

- **精神狀態**: 專注於架構設計與核心邏輯。
- **時間預算**: 2.5 小時。
- **特別注意事項**: 這是一個新模組，需要仔細設計 Prompt 以及與既有服務的互動。

---

## Stage 1: Sprint Planning

### User Stories

- [x] **US-1**: 作為使用者，我希望在 UI 上看到一個「AI 智慧記錄」輸入框，以便我能輸入自然語言描述的工作內容。
- [x] **US-2**: 當我提交文字後，我希望系統能呼叫 Gemini API，並從文字中解析出 `客戶名稱` 和 `活動內容`。
- [x] **US-3**: 系統應根據解析出的 `客戶名稱`，自動查詢 `crm` 資料表。如果客戶不存在，則為我建立一筆新的客戶資料。
- [x] **US-4**: 系統應根據解析出的資訊，自動在 `work_log` 資料表中建立一筆新的活動紀錄，並將其與正確的客戶關聯。

### Definition of Done（完成定義）

- [ ] **DoD-1**: UI 上存在一個「AI 智慧記錄」的 `st.text_area` 和提交按鈕。
- [ ] **DoD-2**: 建立一個新的服務 `services/intelligent_log.py`，其中包含一個函式，能夠接收文字輸入、建構 Prompt，並呼叫 Gemini API。
- [ ] **DoD-3**: Gemini API 能夠成功回傳一個包含 `company_name` 和 `log_content` 等欄位的結構化 JSON 物件。
- [ ] **DoD-4**: 系統能夠正確地使用 `crm_svc` 來查詢或建立客戶。
- [ ] **DoD-5**: 系統能夠正確地使用 `work_log_svc` 來建立工作日誌。
- [ ] **DoD-6**: 整個流程可以端到端 (end-to-end) 運作：輸入一段包含客戶名稱的文字，系統會正確地在 `crm` 和 `work_log` 中建立資料。
- [ ] **DoD-7**: 所有新程式碼都通過 `pre-commit` 檢查。

### Context Files（AI 參考檔案）

- `services/crm.py` (將被呼叫)
- `services/work_log.py` (將被呼叫)
- `GEMINI.md` (了解 Gemini API 使用的潛在規範)
- `constants.py`

---

## Stage 2: Vibe Coding

### 實作紀錄

> (開發過程中填寫)

### TODO / 技術債

> (開發過程中填寫)

---

## Stage 3: Sprint Review

### DoD 驗證結果

> (開發完成後填寫)

---

## Stage 4: Retrospective & Refactor

> (Sprint 完成後填寫)
