# Sprint S19 — AI 智慧記錄 (Phase 2)

> **狀態**: `in_progress`
> **預估時間**: 3 小時
> **前置 Sprint**: S18

---

## Stage 0: Sprint Kickoff

### 前次 Sprint 回顧

- 前次 Sprint: S18
- 完成狀態: 已完成。「AI 智慧記錄」功能第一版已上線，可自動建立客戶 (CRM) 及工作日誌 (Work Log)。

### Sprint 目標宣告

> 擴充「AI 智慧記錄」功能，使其能夠從自然語言中解析出**專案資訊**和**未來任務**，並自動建立或更新對應的**業務 Pipeline (`project_list`)** 和**待辦事項 (`project_task`)**。

### 前置條件檢查

- [x] S18 已完成。
- [x] Gemini API 已可正常調用。

### Session 意圖

- **精神狀態**: 擴充現有 AI 邏輯，處理更複雜的資訊解析。
- **時間預算**: 2.5 小時。
- **特別注意事項**: 需要精心設計 Prompt 以便解析出更複雜的結構，並增加與 `project` 和 `project_task` 服務的互動。

---

## Stage 1: Sprint Planning

### User Stories

- [x] **US-1**: 作為使用者，當我輸入的日誌包含專案或商機資訊時（例如「...預計過年後第一週簽署POC協議...」），我希望系統能自動為我建立一個新的 `project_list` 項目。
- [x] **US-2**: 我希望系統能從文字中推斷出合理的**專案名稱** (e.g., "桃園捷運-冰水主機案") 和初始**狀態** (e.g., `L0: 客戶開發`)。
- [x] **US-3**: 當文字中包含未來具體的行動或日期時（例如「二月底內部工作坊」），我希望系統能自動在對應的專案下，為我建立一筆 `project_task` 紀錄。
- [x] **US-4**: 我希望系統能從文字中解析出任務的**截止日期 (`due_date`)**。

### Definition of Done（完成定義）

- [ ] **DoD-1**: `services/intelligent_log.py` 中的 Prompt 已更新，要求 Gemini 模型額外解析 `project_name`、`project_status_code` 和一個 `tasks` 陣列（包含 `task_name` 和 `due_date`）。
- [ ] **DoD-2**: AI 服務能成功解析出包含上述新欄位的 JSON 物件。
- [ ] **DoD-3**: 系統邏輯會呼叫 `project_svc.create` 來建立新的業務 Pipeline。
- [ ] **DoD-4**: 系統邏輯會呼叫 `task_svc.create` 來為新建立的專案新增待辦任務。
- [ ] **DoD-5**: 整個流程可以端到端運作：輸入一段包含商機和未來任務的文字，系統會正確地在 `crm`, `work_log`, `project_list`, `project_task` 中建立資料。
- [ ] **DoD-6**: 執行成功後，前端介面會顯示更詳細的成功訊息，告知使用者所有被自動建立的項目。
- [ ] **DoD-7**: 所有新程式碼都通過 `pre-commit` 檢查。

### Context Files（AI 參考檔案）

- `services/intelligent_log.py`
- `services/project.py`
- `services/project_task.py`
- `constants.py` (用於查詢 `status_code`)

---

## Stage 2: Vibe Coding

### 實作紀錄

> (開發過程中填寫)

### TODO / 技術債

> (開發過程中填寫)

---

## Stage 3: Sprint Review

### DoD 驗證結果

> (開發完成後填寫)

---

## Stage 4: Retrospective & Refactor

> (Sprint 完成後填寫)
