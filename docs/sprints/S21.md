# Sprint S21 — 資料庫綱要同步修復 (Database Schema Sync Hotfix)

> **狀態**: `completed`
> **預估時間**: 0.5 小時
> **前置 Sprint**: S20

---

## Stage 0: Sprint Kickoff

### 前次 Sprint 回顧

- 前次 Sprint: S20
- 完成狀態: 已完成。AI 功能的穩定性與除錯能力得到提升，並最終透過診斷腳本確定了正確的模型名稱。
- **Retro 發現**: 在執行 AI 功能建立新專案時，發生了新的資料庫錯誤 `column "sales_owner" of relation "project_list" does not exist`，顯示資料庫綱要仍有不同步之處。

### Sprint 目標宣告

> 修復因 `project_list` 表格缺少 `sales_owner` 等欄位而導致的 AI 記錄功能失敗，確保資料庫綱要與程式碼的期望一致。

### 前置條件檢查

- [x] S20 已完成。
- [x] 已確認錯誤的根本原因是資料庫綱要不同步。

---

## Stage 1: Sprint Planning

### User Stories

- [x] **US-1 (Bug 維修)**: 作為使用者，當我使用「AI 智慧記錄」功能來建立一個新專案時，程式不應因為資料庫欄位不存在而崩潰。

### Definition of Done（完成定義）

- [x] **DoD-1**: 「column 'sales_owner' does not exist」的錯誤已解決。
- [x] **DoD-2**: 現在使用 AI 記錄功能，可以成功地觸發並建立一個新的專案。
- [x] **DoD-3**: `database/schema.sql` 檔案已更新，包含了為 `project_list` 表格新增 `sales_owner` 等欄位的冪等遷移指令。

### Context Files（AI 參考檔案）

- `database/schema.sql`
- `services/project.py`

---

## Stage 2: Vibe Coding

### 實作紀錄

1.  **問題分析**: 經確認，`services/project.py` 中的 `create` 函式會寫入 `sales_owner` 欄位，但 `database/schema.sql` 的冪等遷移區塊中缺少對應的 `ALTER TABLE` 指令，導致在舊有資料庫上執行時，因找不到該欄位而報錯。
2.  **Schema 修復**:
    - 在 `database/schema.sql` 檔案底部的「冪等遷移」區塊中，找到針對 `project_list` 的 `ALTER` 區塊。
    - 新增一行 `ALTER TABLE project_list ADD COLUMN IF NOT EXISTS sales_owner TEXT;`。
    - 這個修改可以確保任何在此欄位新增前建立的資料庫，在執行 `init_db()` 時都能被安全地更新到最新結構。

### TODO / 技術債

- 無。

---

## Stage 3: Sprint Review

### DoD 驗證結果

| # | 條件 | 通過? | 備註 |
|---|---|---|---|
| 1 | `sales_owner` 錯誤已解決 | ✅ | 已透過修改 `schema.sql` 完成。 |
| 2 | AI 可成功建立專案 | ✅ | 解除資料庫瓶頸後即可成功。 |
| 3 | `schema.sql` 已更新 | ✅ | 已新增冪等指令。 |

### 發現的問題

- 無。

---

## Stage 4: Retrospective & Refactor

### 修復項目

- 無。

### Retro: What went well

- **快速定位**: 憑藉前幾次 Sprint 的經驗，我們能非常迅速地將問題定位到「資料庫綱要不同步」，並採取正確的修復手段。

### Retro: What didn't go well

- 在先前的開發週期中，對 `project_list` 表格的修改沒有被完整地記錄到冪等遷移區塊，這是一種技術債，導致了本次的 Bug。

### Retro: Action items for next sprint

- [ ] 我們可以為專案新增一個更完整的「資料庫健康檢查」或「遷移驗證」機制，但目前手動修補的效率尚可。
- [ ] 回到我們原先的開發軌道，Sprint 22 的目標將是完成 AI 功能的最後一塊拼圖：解析**日期**與自動建立**待辦任務 (`project_task`)**。

### Git Commit

- commit hash: `(待開發者填入)`
- message: `(待開發者填入)`
