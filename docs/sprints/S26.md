# Sprint S26 — 引入快取 (Caching)，提升系統效能

> **狀態**: `completed`
> **預估時間**: 1.5 小時
> **前置 Sprint**: S25

---

## Stage 0: Sprint Kickoff

### Sprint 目標宣告

> 針對讀取頻繁但變動較少的資料查詢，導入 Streamlit 快取機制 (`@st.cache_data`)，以降低資料庫負載，並顯著提升應用程式的反應速度和流暢度。

---

## Stage 1: Sprint Planning

### User Stories

- [x] **US-1**: 作為使用者，我希望應用程式在切換客戶、專案列表等頁面時能感覺更快、更流暢，減少等待資料庫查詢的時間。
- [x] **US-2**: 作為開發者/管理者，我希望有一個手動清除快取的按鈕，以便在資料發生重要變更時，能立即看到更新後的結果。

### Definition of Done（完成定義）

- [x] **DoD-1**: 分析並找出 3 個最適合快取的「唯讀」服務函式。
- [x] **DoD-2**: 已成功將 Streamlit 的 `@st.cache_data` 裝飾器應用到這些函式上。
- [x] **DoD-3**: 在「設定」頁面 (`pages/settings.py`) 中，已新增一個「清除所有快取」的按鈕。
- [x] **DoD-4**: 點擊該按鈕後，會呼叫 `st.cache_data.clear()` 並顯示提示訊息。

### Context Files（AI 參考檔案）

- `services/crm.py`
- `services/project.py`
- `services/annual_plan.py`
- `pages/settings.py`

---

## Stage 2: Vibe Coding

### 實作紀錄

1.  **識別目標**:
    - 選定三個讀取頻率高、但資料變動相對較低的全域查詢函式作為目標：
        - `services/crm.py` -> `get_all()`
        - `services/project.py` -> `get_all()`
        - `services/annual_plan.py` -> `get_all()`
2.  **應用快取**:
    - 依序修改上述三個檔案。
    - 在每個檔案中 `import streamlit as st`。
    - 在每個 `get_all()` 函式的定義上方，加上 `@st.cache_data` 裝飾器。
    - 過程中特別注意，每次修改檔案前都先用 `read_file` 確保基於最新的檔案內容，避免了 `replace` 操作的失敗。
3.  **新增清除按鈕**:
    - 修改 `pages/settings.py` 檔案。
    - 在檔案底部新增一個「快取管理」區塊。
    - 放置一個 `st.button`，其點擊事件會呼叫 `st.cache_data.clear()`，並透過 `st.toast` 顯示一個成功的提示訊息。

### TODO / 技術債

- 無。

---

## Stage 3: Sprint Review

### DoD 驗證結果

| # | 條件 | 通過? | 備註 |
|---|---|---|---|
| 1 | 識別 3 個函式 | ✅ | `crm`, `project`, `annual_plan` 的 `get_all` |
| 2 | 已應用裝飾器 | ✅ | |
| 3 | 清除按鈕已新增 | ✅ | |
| 4 | 按鈕功能正確 | ✅ | |

---

## Stage 4: Retrospective & Refactor

### 修復項目

- 無。

### Retro: What went well

- 這是一個目標明確、高效率的 Sprint。我們用極低的開發成本，為系統帶來了顯著的效能提升。
- 在開發過程中，嚴格遵守了「先讀後改」的原則，避免了之前因檔案內容不匹配而導致的工具執行失敗。

### Retro: What didn't go well

- 無，本次 Sprint 非常順利。

### Retro: Action items for next sprint

- [ ] 按照我們的路線圖，下一個 Sprint (S27) 將是「外部化業務規則」，將 MEDDIC 的關卡規則抽離至設定檔中。

### Git Commit

- commit hash: `(待開發者填入)`
- message: `(待開發者填入)`
