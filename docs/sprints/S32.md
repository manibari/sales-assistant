# Sprint 32 — Hotfix: `annual_plan` Page Crash

> **狀態**: `completed`
> **預估時間**: 0.5 小時
> **前置 Sprint**: S31

---

## Stage 0: Sprint Kickoff

### Sprint 目標宣告

> 修復因 `pages/annual_plan.py` 呼叫了不存在的 `settings_svc.get_value` 函式而導致的 `AttributeError` 系統崩潰問題。

---

## Stage 1: Sprint Planning

### User Stories

- [x] **US-1 (Bug 維修)**: 作為使用者，當我點擊「年度戰情室」頁面時，應用程式不應發生 `AttributeError` 崩潰，而應能正常顯示頁面內容。

### Definition of Done（完成定義）

- [x] **DoD-1**: `AttributeError: module 'services.settings' has no attribute 'get_value'` 的錯誤已解決。
- [x] **DoD-2**: `pages/annual_plan.py` 已被修改，改為使用既有的 `get_all_headers` 函式，並安全地讀取設定值。
- [x] **DoD-3**: 「年度戰情室」頁面可以成功載入並渲染。

### Context Files（AI 參考檔案）

- `pages/annual_plan.py`
- `services/settings.py`

---

## Stage 2: Vibe Coding

### 實作紀錄

1.  **問題定位**: 根據使用者回報的 `AttributeError`，透過 `grep` 搜尋，精準定位到錯誤來源為 `pages/annual_plan.py` 的第 25 行。
2.  **分析**: 經查閱 `services/settings.py`，確認該服務中只存在 `get_all_headers` 函式，並不存在 `get_value` 函式。
3.  **修復**:
    - 修改 `pages/annual_plan.py`。
    - 將 `hourly_rate = float(settings_svc.get_value("hourly_cost_rate", 100))` 這一行錯誤的程式碼，替換為兩行更穩健的程式碼：
        1. `app_settings = settings_svc.get_all_headers()`
        2. `hourly_rate = float(app_settings.get("hourly_cost_rate", 100))`
    - 這個作法不僅修復了 Bug，還採用了防禦性設計，確保即使未來該設定值不存在，程式也能因為有預設值而正常運行。

### TODO / 技術債

- 無。

---

## Stage 3: Sprint Review

### DoD 驗證結果

| # | 條件 | 通過? | 備註 |
|---|---|---|---|
| 1 | `AttributeError` 已解決 | ✅ | |
| 2 | `annual_plan.py` 已重構 | ✅ | |
| 3 | 頁面可成功載入 | ✅ | |

---

## Stage 4: Retrospective & Refactor

### 修復項目

- 無。

### Retro: What went well

- **精準定位**: 透過 `grep` 工具，我們非常快速地找到了問題的根源。
- **穩健修復**: 採用了「安全取值搭配預設值」的防禦性程式設計模式，不僅修復了 Bug，還提升了程式碼的強健性。

### Retro: What didn't go well

- 這是一個在之前的開發週期中，因疏忽而遺留下來的 Bug，提醒我們在未來對程式碼的靜態檢查應更加仔細。

### Retro: Action items for next sprint

- [ ] 系統穩定性問題已解決。我們可以回到 S31 時的計畫，將 Sprint 33 的目標設定為：完成 AI 功能的最後一塊拼圖——從文字中解析**日期**與**待辦事項**，並自動在 `project_task` 中建立任務。

### Git Commit

- commit hash: `(待開發者填入)`
- message: `(待開發者填入)`
